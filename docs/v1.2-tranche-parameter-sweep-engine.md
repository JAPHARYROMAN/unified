# Unified v1.2 â€” Tranche Parameter Sweep & Heatmap Engine

## Purpose
Extend the stress simulation framework with deterministic parameter sweeps across tranche structure, recovery assumptions, liquidity behavior, and correlation regimes.

## Parameter Grid
- `seniorAllocationBps`: `6000, 6500, 7000, 7500, 8000, 8500, 9000`
- `juniorCoverageFloorBps`: `1000, 1500, 2000`
- `recoveryRate`: `0.30, 0.40, 0.50, 0.60`
- `withdrawalSensitivity`: `LOW, MEDIUM, HIGH`
- `correlationLevel`: `LOW, MODERATE, CLUSTERED`

Total configurations: `756`.

## Seeds and Determinism
- Seeds per configuration: `100` (minimum required).
- Total runs: `75,600`.
- Deterministic seed mixer: `sha256(baseSeed + config + seedIndex)`.
- Determinism rule: same `baseSeed + config + seedIndex` yields identical run outputs.

## Engine Behavior
- Simulates tranche NAV paths across discrete timesteps.
- Applies stress shocks with correlation-dependent clustering.
- Applies waterfall loss allocation (`junior` then `senior`).
- Applies delayed partial recoveries in reverse impairment order.
- Simulates breaker activation and stabilization windows under liquidity and coverage breaches.
- Tracks queue pressure / liquidity ratio feedback loop.

## Output Metrics (per configuration)
- `seniorImpairmentProbability`
- `juniorDepletionProbability`
- `breakerActivationFrequency`
- `avgBreakerDuration`
- `avgTimeToStabilization`
- `avgJuniorNAVVolatility`
- `avgSeniorNAVVolatility`
- `capitalEfficiencyScore`

Additional guardrail metrics:
- `waterfallViolationCount` (must be `0`)
- `negativeNavCount` (must be `0`)

## Heatmap / Surface Output Contract
JSON includes:
- `metadata`
- `parameterAxes`
- `records[]` (configuration + metrics)
- `heatmap[]` slices (`x=seniorAllocationBps`, `y=recoveryRate`)
- `contours[]` (risk-score points by slice)
- `invariants`

CSV includes one row per configuration with all metric columns.

## Export Paths
- `docs/simulations/tranche-parameter-sweep/tranche-parameter-sweep-heatmap.json`
- `docs/simulations/tranche-parameter-sweep/tranche-parameter-sweep-heatmap.csv`

## Acceptance Mapping
- No waterfall violations: enforced and asserted (`0`).
- No negative NAV states: enforced and asserted (`0`).
- Reproducibility: explicit deterministic replay assertion in spec.
- Heatmap exportability: JSON + CSV writer with validated row counts.
